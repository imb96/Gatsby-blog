{"componentChunkName":"component---src-templates-post-template-tsx","path":"/EventLoop/","result":{"data":{"allMarkdownRemark":{"edges":[{"node":{"html":"<p>자바스크립트는 <code class=\"language-text\">단일 스레드</code> 이다.</p>\n<p>스레드가 하나라는 말은 동시에 하나의 작업만 처리할 수 있다는 뜻이고 자바스크립트 엔진이 단일 호출 스택을 사용한다는 뜻이다.</p>\n<p>자바스크립트가 구동되는 환경인 브라우저에서는 여러 개의 스레드가 사용된다.</p>\n<p>브라우저는 자바스크립트 엔진이 제공하지 않는 웹 API를 제공하며 이를 통해서 비동기 방식으로 동작할 수 있다.</p>\n<p>이러한 구동 환경이 단일 호출 스택을 사용하는 자바스크립트 엔진과 상호 연동하기 위한 장치가 <code class=\"language-text\">이벤트 루프</code> 이다.</p>\n<p>자바스크립트는 이벤트 루프를 이용해서 비동기 방식으로 동시성을 지원한다.</p>\n<img alt=\"스크린샷 2023-12-19 오후 1 30 09\" src=\"https://github.com/imb96/imb96.github.io/assets/71740032/8db3adba-67bb-4c16-91e2-5367e3235480\">\n<h3>Heap</h3>\n<p>메모리 할당이 되는 곳, 선언현 변수와 함수가 담겨져 있다.</p>\n<h3>Call Stack</h3>\n<p>코드가 실행될 때 쌓이는 곳이다.</p>\n<p>요청이 들어올 때마다 순차적으로 호출 스택을 담아서 처리한다.</p>\n<p>함수가 실행되면 Call Stack에 프레임이 생기고 처리가 끝나면 없어진다.</p>\n<h3>Web APIs</h3>\n<p>브라우저에서 제공하는 API로 비동기인 setTimeout, Promise등이 있다.</p>\n<p>Call Stack에서 실행된 비동기 함수들은 모두 Web API를 호출한다.</p>\n<p>그리고 Web API는 콜백 함수를 Callback Queue에 넣는다.</p>\n<h3>Callback Queue</h3>\n<p>비동기적으로 실행된 콜백 함수가 보관되는 곳이다.</p>\n<ul>\n<li><strong>Microtask Queue</strong>: Promise callback, async callback과 같은 코드.</li>\n<li><strong>Task Queue(Macrotask Queue)</strong>: setTimeout, setInterval과 같은 코드.</li>\n<li><strong>Animation Frames</strong>: requestAnimationFrame과 같은코드</li>\n</ul>\n<br />\n큐 들의 실행 우선순위는 이렇다.\n<p>Microtask Queue -> Animation Frame -> Task Queue</p>\n<h3>Event Loop</h3>\n<p>Call Stack과 Callback Queue들을 감시하면서 어떤게 비어져있고 어떤것을 채워야할지 정하며 수행한다.</p>\n<p>예를 들어서 DOM 요소에 이벤트를 등록하는 코드를 작성했다고 해보자.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">document<span class=\"token punctuation\">.</span><span class=\"token function\">getElementById</span><span class=\"token punctuation\">(</span><span class=\"token string\">'btn'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'click'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'hi'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<ol>\n<li>\n<p>getElementById 함수가 호출되어 해당 함수가 Call Stack에 들어가고 id가 ‘btn’인 요소를 찾아 반환하고 pop된다.</p>\n</li>\n<li>\n<p>addEventListener(‘click’, () => console.log(‘hi’)) 이 코드가 Call Stack에 들어가고 실행되어</p>\n</li>\n</ol>\n<p>이벤트 핸들러 함수 () => console.log(‘hi’)가 DOM 요소의 클릭 이벤트에 등록된다.</p>\n<ol start=\"3\">\n<li>\n<p>이벤트 핸들러 함수는 Web API의 이벤트 리스너 목록에 등록되어 클릭 이벤트가 발생할 때까지 대기한다.</p>\n</li>\n<li>\n<p>사용자가 해당 버튼을 클릭하면, 브라우저는 해당 이벤트를 감지하고 이벤트 핸들러 함수를 호출하기 위해 Web API에서 Callback Queue로 이동시킨다.</p>\n</li>\n<li>\n<p>Event Loop는 Call Stack이 비어있을 때, Microtask Queue (Promise의 경우)와 Callback Queue를 확인하고, 우선순위에 따라 Microtask Queue를 먼저 처리한다.</p>\n</li>\n<li>\n<p>이벤트 핸들러 함수는 Callback Queue (Microtask Queue)에서 Call Stack으로 이동되어 실행된다.</p>\n</li>\n</ol>\n<p>따라서 클릭 이벤트가 발생하면 해당 이벤트 핸들러 함수가 Callback Queue를 통해 호출되어 실행되고,\nconsole.log(‘hi’)가 출력되게 된다.</p>\n<br />\n<p>다음 코드로 동작 과정을 다시 살펴 보자.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'hi'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'timeout'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nPromise<span class=\"token punctuation\">.</span><span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span><span class=\"token string\">'promise'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">res</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>res<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'bye'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<ol>\n<li>console.log(’hi’) 가 CallStack에 쌓이게 되고 실행되고 제거된다.</li>\n<li>setTimeout(() ⇒ console.log(’timeout’)) 이 Call Stack에 쌓이고 Callback 함수를 Web APIs로 보내면서 나온다.</li>\n<li>Web APIs에서 () ⇒ console.log(’timeout’)을 Task Queue로 보낸다.</li>\n<li>Promise.resolve, then((res) ⇒ console.log(res))가 Call Stack에 쌓이고 (res) ⇒ console.log(res)를 Microtask Queue에 보낸다.</li>\n<li>console.log(‘bye’)가 Call Stack에 쌓이게 되고 실행되고 제거된다.</li>\n<li>Microtask Queue에있던 (res) ⇒ console.log(res)가 Call Stack에 쌓이게 되고 실행되고 제거된다.</li>\n<li>Task Queue에 있던 () ⇒ console.log(’timeout’)가 Call Stack에 쌓이게 되고 실행되고 제거된다.</li>\n</ol>\n<br />\n<p>따라서 실행 결과는 이렇게 된다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">hi\nbye\npromise\ntimeout</code></pre></div>\n<p>참고</p>\n<p><a href=\"https://dev.to/lydiahallie/javascript-visualized-event-loop-3dif\" target=\"_blank\" rel=\"nofollow\">https://dev.to/lydiahallie/javascript-visualized-event-loop-3dif</a></p>\n<p><a href=\"https://talkwithcode.tistory.com/89\" target=\"_blank\" rel=\"nofollow\">https://talkwithcode.tistory.com/89</a></p>","frontmatter":{"title":"자바스크립트 Event Loop","summary":"Event Loop와 비동기","date":"2023.12.19","categories":["js"],"thumbnail":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","placeholder":{"fallback":"data:image/jpeg;base64,/9j/2wBDAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQH/2wBDAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQH/wgARCAAMABQDASIAAhEBAxEB/8QAGgAAAQUBAAAAAAAAAAAAAAAAAAIEBQYHCf/EABcBAAMBAAAAAAAAAAAAAAAAAAABAwX/2gAMAwEAAhADEAAAAe0tF1dniUlhAj//xAAaEAACAwEBAAAAAAAAAAAAAAADBAACBQEG/9oACAEBAAEFAtZthJbK9RzSYhBjNUaSQbz/xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAYEQACAwAAAAAAAAAAAAAAAAAQIRExUf/aAAgBAgEBPwFRT0f/xAAgEAADAAIBBQEBAAAAAAAAAAABAgMEEQUAEhMUITEQ/9oACAEBAAY/Ap3xklV/agjRrScRWTChqiXq6Rx6dqdy2sTNQrdynY642DHAx7XFp5WLHlOJ5Ohr6csrGtjNgZ9X9SpGWBTw0BEdu0tgt147TnVDolKzWiEj6CVcMuwfo+fD+dLSODhRogISksTHlRA2+4K6TVlDbOwCN7O/0/z/xAAZEAEBAQEBAQAAAAAAAAAAAAABESEAEEH/2gAIAQEAAT8h3RukuV5iHSIRzWHvMOay43mNU8jY1OCFa0h74QABwD2ds52vf//aAAwDAQACAAMAAAAQaM//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/ED//xAAZEQEBAQEBAQAAAAAAAAAAAAABIRFREDH/2gAIAQIBAT8QEoU1mvkwnNvZE3z/xAAaEAEAAgMBAAAAAAAAAAAAAAABABEQUaHR/9oACAEBAAE/EKONOCI6m5QZ58J8h8PKu/5Ac/E4oQgKIYBg9KSwprROkB30d9n/2Q=="},"images":{"fallback":{"src":"/static/2df6bd11efdc8de0ac54d805ca1ba1ab/97099/til.jpg","srcSet":"/static/2df6bd11efdc8de0ac54d805ca1ba1ab/d75cc/til.jpg 557w,\n/static/2df6bd11efdc8de0ac54d805ca1ba1ab/a3617/til.jpg 1113w,\n/static/2df6bd11efdc8de0ac54d805ca1ba1ab/97099/til.jpg 2226w","sizes":"(min-width: 2226px) 2226px, 100vw"},"sources":[{"srcSet":"/static/2df6bd11efdc8de0ac54d805ca1ba1ab/9e13a/til.webp 557w,\n/static/2df6bd11efdc8de0ac54d805ca1ba1ab/f9e0a/til.webp 1113w,\n/static/2df6bd11efdc8de0ac54d805ca1ba1ab/b09bd/til.webp 2226w","type":"image/webp","sizes":"(min-width: 2226px) 2226px, 100vw"}]},"width":2226,"height":1322}},"publicURL":"/static/2df6bd11efdc8de0ac54d805ca1ba1ab/til.jpg"}}}}]}},"pageContext":{"slug":"/EventLoop/"}},"staticQueryHashes":[]}