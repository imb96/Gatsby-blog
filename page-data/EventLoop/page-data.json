{"componentChunkName":"component---src-templates-post-template-tsx","path":"/EventLoop/","result":{"data":{"allMarkdownRemark":{"edges":[{"node":{"html":"<p>자바스크립트는 <strong>싱글 스레드</strong> 이다.<br>\n스레드가 하나라는 말은 동시에 하나의 작업만 처리할 수 있다는 뜻이고 자바스크립트 엔진이 단일 호출 스택을 사용한다는 뜻이다.</p>\n<p>자바스크립트가 구동되는 환경인 브라우저에서는 여러 개의 스레드가 사용된다.<br>\n브라우저는 자바스크립트 엔진이 제공하지 않는 웹 API를 제공하며 이를 통해서 비동기 방식으로 동작할 수 있다.\n이러한 구동 환경이 단일 호출 스택을 사용하는 자바스크립트 엔진과 상호 연동하기 위한 장치가 <strong>이벤트 루프</strong> 이다.\n자바스크립트는 이벤트 루프를 이용해서 비동기 방식으로 동시성을 지원한다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 768px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/d5b95bb3664ac382cd1926fb22e6955a/d3e70/eventloop.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 91.66666666666667%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAYAAABb0P4QAAAACXBIWXMAAAsTAAALEwEAmpwYAAABtElEQVR42oXUh24jMQwEUP//PxpwL3Dv3QqeDrPwJRtEAK0VRQ6HRe6Uj/V8Psvlcil/rcPhUNbrddlsNvX8fr+bu46f2+1WgXa7XZnNZuV4PJbT6VSu12tjLJjz+Xwuo9GoTKfTslgsqh3f+/3+D/D1elXFYDCoERlw6Pf7lcnj8aiGgIAK5m48HpfhcFh96Pk1gJiFJQfRsHHOTjjP5/PKbjKZVMDlclklpaqAq9WqHnxvt9vmO2ljZ3cHCIB0ARLfCDWAFGqFegpNH7ZJeb/f12yk3O12S6/Xq82hZ1sBAVHa2xgGEEMs7AhI3f5ZlgZQVI4cRMLU+bN739dv41UBMZFSaiYA1gIAb1tJMSvj1cmMESNC0u02MI5Yq5uykP8YtkUP6GfklEEmmqHbZlEm9JnXThsYdhnqdB9QZtaYmQavShPTwB+AANSQQUAyLvREIGCAzGMehbsfgGm/aDGKoTM9QAEAEmcZtQJyYiAlxhyBRCzszB92niBbZWnm8BNQcTN3McqTopde6itgzilJa1PSyTy71BJDNcbQP1P+ILyY2Pw6Nm0Dm1FKk8KUYJex+QJNFnokEBf8NQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/d5b95bb3664ac382cd1926fb22e6955a/a59e9/eventloop.webp 192w,\n/static/d5b95bb3664ac382cd1926fb22e6955a/0ca9f/eventloop.webp 384w,\n/static/d5b95bb3664ac382cd1926fb22e6955a/dc9b9/eventloop.webp 768w,\n/static/d5b95bb3664ac382cd1926fb22e6955a/b5541/eventloop.webp 897w\"\n              sizes=\"(max-width: 768px) 100vw, 768px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/d5b95bb3664ac382cd1926fb22e6955a/3b721/eventloop.png 192w,\n/static/d5b95bb3664ac382cd1926fb22e6955a/66595/eventloop.png 384w,\n/static/d5b95bb3664ac382cd1926fb22e6955a/fe486/eventloop.png 768w,\n/static/d5b95bb3664ac382cd1926fb22e6955a/d3e70/eventloop.png 897w\"\n            sizes=\"(max-width: 768px) 100vw, 768px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/d5b95bb3664ac382cd1926fb22e6955a/fe486/eventloop.png\"\n            alt=\"eventloop\"\n            title=\"eventloop\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<h3>Heap</h3>\n<p>메모리 할당이 되는 곳, 선언현 변수와 함수가 담겨져 있다.</p>\n<h3>Call Stack</h3>\n<p>코드가 실행될 때 쌓이는 곳이다.\n요청이 들어올 때마다 순차적으로 호출 스택을 담아서 처리한다.\n함수가 실행되면 Call Stack에 프레임이 생기고 처리가 끝나면 없어진다.</p>\n<h3>Web APIs</h3>\n<p>브라우저에서 제공하는 API로 비동기인 setTimeout, Promise등이 있다.\nCall Stack에서 실행된 비동기 함수들은 모두 Web API를 호출한다.\n그리고 Web API는 콜백 함수를 Callback Queue에 넣는다.</p>\n<h3>Callback Queue</h3>\n<p>비동기적으로 실행된 콜백 함수가 보관되는 곳이다.</p>\n<ul>\n<li><strong>Microtask Queue</strong>: Promise callback, async callback과 같은 코드.</li>\n<li><strong>Task Queue(Macrotask Queue)</strong>: setTimeout, setInterval과 같은 코드.</li>\n<li><strong>Animation Frames</strong>: requestAnimationFrame과 같은코드</li>\n</ul>\n<br />\n큐 들의 실행 우선순위는 이렇다.\n<p>Microtask Queue -> Animation Frame -> Task Queue</p>\n<h3>Event Loop</h3>\n<p>Call Stack과 Callback Queue들을 감시하면서 어떤게 비어져있고 어떤것을 채워야할지 정하며 수행한다.<br>\n예를 들어서 DOM 요소에 이벤트를 등록하는 코드를 작성했다고 해보자.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">document<span class=\"token punctuation\">.</span><span class=\"token function\">getElementById</span><span class=\"token punctuation\">(</span><span class=\"token string\">'btn'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'click'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'hi'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<ol>\n<li>getElementById 함수가 호출되어 해당 함수가 Call Stack에 들어가고 id가 ‘btn’인 요소를 찾아 반환하고 pop된다.</li>\n<li>addEventListener(‘click’, () => console.log(‘hi’)) 이 코드가 Call Stack에 들어가고 실행되어 이벤트 핸들러 함수 () => console.log(‘hi’)가 DOM 요소의 클릭 이벤트에 등록된다.</li>\n<li>이벤트 핸들러 함수는 Web API의 이벤트 리스너 목록에 등록되어 클릭 이벤트가 발생할 때까지 대기한다.</li>\n<li>사용자가 해당 버튼을 클릭하면, 브라우저는 해당 이벤트를 감지하고 이벤트 핸들러 함수를 호출하기 위해 Web API에서 Callback Queue로 이동시킨다.</li>\n<li>Event Loop는 Call Stack이 비어있을 때, Microtask Queue (Promise의 경우)와 Callback Queue를 확인하고, 우선순위에 따라 Microtask Queue를 먼저 처리한다.</li>\n<li>이벤트 핸들러 함수는 Callback Queue (Microtask Queue)에서 Call Stack으로 이동되어 실행된다.</li>\n</ol>\n<p>따라서 클릭 이벤트가 발생하면 해당 이벤트 핸들러 함수가 Callback Queue를 통해 호출되어 실행되고,\nconsole.log(‘hi’)가 출력되게 된다.</p>\n<p>다음 코드로 동작 과정을 다시 살펴 보자.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'hi'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'timeout'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nPromise<span class=\"token punctuation\">.</span><span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span><span class=\"token string\">'promise'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">res</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>res<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'bye'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<br />\n<ol>\n<li>console.log(’hi’) 가 CallStack에 쌓이게 되고 실행되고 제거된다.</li>\n<li>setTimeout(() ⇒ console.log(’timeout’)) 이 Call Stack에 쌓이고 Callback 함수를 Web APIs로 보내면서 나온다.</li>\n<li>Web APIs에서 () ⇒ console.log(’timeout’)을 Task Queue로 보낸다.</li>\n<li>Promise.resolve, then((res) ⇒ console.log(res))가 Call Stack에 쌓이고 (res) ⇒ console.log(res)를 Microtask Queue에 보낸다.</li>\n<li>console.log(‘bye’)가 Call Stack에 쌓이게 되고 실행되고 제거된다.</li>\n<li>Microtask Queue에있던 (res) ⇒ console.log(res)가 Call Stack에 쌓이게 되고 실행되고 제거된다.</li>\n<li>Task Queue에 있던 () ⇒ console.log(’timeout’)가 Call Stack에 쌓이게 되고 실행되고 제거된다.</li>\n</ol>\n<br />\n<p>따라서 실행 결과는 이렇게 된다.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">hi\nbye\npromise\n<span class=\"token function\">timeout</span></code></pre></div>\n<blockquote>\n<p>참고<br>\n<a href=\"https://dev.to/lydiahallie/javascript-visualized-event-loop-3dif\" target=\"_blank\" rel=\"nofollow\">https://dev.to/lydiahallie/javascript-visualized-event-loop-3dif</a>  <a href=\"https://talkwithcode.tistory.com/89\" target=\"_blank\" rel=\"nofollow\">https://talkwithcode.tistory.com/89</a></p>\n</blockquote>","frontmatter":{"title":"자바스크립트 Event Loop","summary":"자바스크립트가 비동기를 처리하는 법","date":"2023-12-19","categories":["JS"],"thumbnail":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","placeholder":{"fallback":"data:image/jpeg;base64,/9j/2wBDAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQH/2wBDAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQH/wgARCAAMABQDASIAAhEBAxEB/8QAGQAAAgMBAAAAAAAAAAAAAAAAAAUCBgcJ/8QAFwEAAwEAAAAAAAAAAAAAAAAAAAEDBf/aAAwDAQACEAMQAAAB7TUzTV2JR6QEf//EABoQAAMBAAMAAAAAAAAAAAAAAAMEBQACBhX/2gAIAQEAAQUCrOMJLy+y+kfFEI/AU6cuTf/EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8BP//EABcRAAMBAAAAAAAAAAAAAAAAABARITH/2gAIAQIBAT8Biyj/xAAhEAADAAEEAgMBAAAAAAAAAAABAgMEBRESEwAUECExQf/aAAgBAQAGPwKdsaU7v7UkaDvOPbIrVqLO9qxhCgVOYrduoKrcgSR5p8WXFxq3WyZOKuoaVqFe8YccrHpBtP1LIPqWHucKdVVYQBakuS8/Ou8pWmSCZ2mtUJH4Sjhl3H8+vrxa4+nYEKoCqVhhY0aIrb8glJyV1Dcm3AIB3O/6fj//xAAaEAEAAgMBAAAAAAAAAAAAAAABESEAEDFh/9oACAEBAAE/IZPkdz7MFQj4RGks9UegOmcvq2agCmWIW0yXM8wnYKKRjzm6c//aAAwDAQACAAMAAAAQe8//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/ED//xAAaEQEAAgMBAAAAAAAAAAAAAAABESEQMUFx/9oACAECAQE/EBKGVoa6d8bnfNY//8QAGxABAAICAwAAAAAAAAAAAAAAAQARUdFhkaH/2gAIAQEAAT8QRu0Ez2XbzJGDq5ktab8KYomW8dGoppmEZwsr2wststkjaAIyItGAIvg93P/Z"},"images":{"fallback":{"src":"/static/2df6bd11efdc8de0ac54d805ca1ba1ab/97099/til.jpg","srcSet":"/static/2df6bd11efdc8de0ac54d805ca1ba1ab/d75cc/til.jpg 557w,\n/static/2df6bd11efdc8de0ac54d805ca1ba1ab/a3617/til.jpg 1113w,\n/static/2df6bd11efdc8de0ac54d805ca1ba1ab/97099/til.jpg 2226w","sizes":"(min-width: 2226px) 2226px, 100vw"},"sources":[{"srcSet":"/static/2df6bd11efdc8de0ac54d805ca1ba1ab/9e13a/til.webp 557w,\n/static/2df6bd11efdc8de0ac54d805ca1ba1ab/f9e0a/til.webp 1113w,\n/static/2df6bd11efdc8de0ac54d805ca1ba1ab/b09bd/til.webp 2226w","type":"image/webp","sizes":"(min-width: 2226px) 2226px, 100vw"}]},"width":2226,"height":1322}},"publicURL":"/static/2df6bd11efdc8de0ac54d805ca1ba1ab/til.jpg"}}}}]}},"pageContext":{"slug":"/EventLoop/"}},"staticQueryHashes":[],"slicesMap":{}}