{"componentChunkName":"component---src-templates-post-template-tsx","path":"/CORS/","result":{"data":{"allMarkdownRemark":{"edges":[{"node":{"html":"<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 500px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/d053599845ec8e432e05ee0c0c922ff3/601b1/cors.webp\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 123.4375%; position: relative; bottom: 0; left: 0; background-image: url('data:image/webp;base64,UklGRgABAABXRUJQVlA4IPQAAACQBQCdASoUABkAPtFepE6oJSMiKAqpABoJZQCuHywToYT8yLR33DXcHpChKqetZBb21OB6nAD9xyuEU8rA9HZlTt8OXGEF1l7oRKd61wIXtuPPCynRW9lTpx5/1jn5K/l9g86rWPRxZqqlf7Wh9jYKbqwSXSSelz2MgxUuNwfJ3LEk1WXuvDopkfTbX913goF7h7Hr5Yq8TsLFldJYE7xMsgo3NYXJGCU6/67pzBBFFLflWzELCdJTTNjvS+6I3JikuQ10X2mDFyWWLS+OtmQr04IFslUhEggpLlQEvxodSQQv/6mTmOP61hCIVCRPeqxWAAAA'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/d053599845ec8e432e05ee0c0c922ff3/a59e9/cors.webp 192w,\n/static/d053599845ec8e432e05ee0c0c922ff3/0ca9f/cors.webp 384w,\n/static/d053599845ec8e432e05ee0c0c922ff3/601b1/cors.webp 500w\"\n              sizes=\"(max-width: 500px) 100vw, 500px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/d053599845ec8e432e05ee0c0c922ff3/a59e9/cors.webp 192w,\n/static/d053599845ec8e432e05ee0c0c922ff3/0ca9f/cors.webp 384w,\n/static/d053599845ec8e432e05ee0c0c922ff3/601b1/cors.webp 500w\"\n            sizes=\"(max-width: 500px) 100vw, 500px\"\n            type=\"image/webp\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/d053599845ec8e432e05ee0c0c922ff3/601b1/cors.webp\"\n            alt=\"cors\"\n            title=\"cors\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>Next.js를 사용해서 개인 프로젝트를 하면서 여러 open api를 사용하며 CORS 에러들을 만났고 해결했던 방법을 기록하려고 한다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 768px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/e2c5d9be28f0042a602d608c658255ad/9cf50/cors.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 6.25%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAABCAYAAADeko4lAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAS0lEQVQI1x3FyRJAMBBAQf//e7KNTEiIvSg3x6dKX7o5UqE3kdl6qhMmK0yuo7Se0QRGI/+5DawhcqmyibJrZpHE5gNnVKoMvPfDB1AeR/IHOBMVAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/e2c5d9be28f0042a602d608c658255ad/a59e9/cors.webp 192w,\n/static/e2c5d9be28f0042a602d608c658255ad/0ca9f/cors.webp 384w,\n/static/e2c5d9be28f0042a602d608c658255ad/dc9b9/cors.webp 768w,\n/static/e2c5d9be28f0042a602d608c658255ad/e2c2f/cors.webp 1152w,\n/static/e2c5d9be28f0042a602d608c658255ad/f3efb/cors.webp 1536w,\n/static/e2c5d9be28f0042a602d608c658255ad/18c09/cors.webp 2066w\"\n              sizes=\"(max-width: 768px) 100vw, 768px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/e2c5d9be28f0042a602d608c658255ad/3b721/cors.png 192w,\n/static/e2c5d9be28f0042a602d608c658255ad/66595/cors.png 384w,\n/static/e2c5d9be28f0042a602d608c658255ad/fe486/cors.png 768w,\n/static/e2c5d9be28f0042a602d608c658255ad/d2d74/cors.png 1152w,\n/static/e2c5d9be28f0042a602d608c658255ad/e8464/cors.png 1536w,\n/static/e2c5d9be28f0042a602d608c658255ad/9cf50/cors.png 2066w\"\n            sizes=\"(max-width: 768px) 100vw, 768px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/e2c5d9be28f0042a602d608c658255ad/fe486/cors.png\"\n            alt=\"cors\"\n            title=\"cors\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>먼저 SOP와 CORS에 대해 알아보자</p>\n<h3>SOP</h3>\n<p>SOP(Same-Origin Policy)는 웹 페이지가 다른 origin(도메인, 프로토콜 또는 포트)에 있는 리소스에 요청하는 것을 방지하기 위해 웹 브라우저가 시행하는 기본적인 보안 조치이다. SOP에서 하나의 origin에서 제공되는 웹 페이지는 기본적으로 동일한 origin의 리소스(예: 데이터, 스크립트 및 쿠키)와 상호 작용하는 것만 허용된다. 이 제한은 악의적인 스크립트가 중요한 데이터에 액세스하거나 사용자를 대신하여 승인되지 않은 동작을 수행하는 것을 방지함으로써 XSS(Cross-Site Scripting) 및 CSRF(Cross-Site Request Fuaging)를 포함한 다양한 보안 취약성을 완화하는 데 도움이 된다.</p>\n<h3>CORS</h3>\n<p>CORS(Cross-Origin Resource Sharing)는 브라우저에서 발생하는 크로스 도메인 이슈를 해결하기 위한 메커니즘이다. CORS는 브라우저에서 동작하며, 다른 출처(origin)의 리소스를 요청할 때, 서버에서 허용하지 않는 경우 브라우저가 해당 요청을 차단한다. 이를 해결하기 위해, 서버에서는 응답 헤더를 설정하여 허용하는 출처, 허용하는 HTTP 메서드 등을 지정하며 브라우저는 이를 확인하여 해당 리소스에 대한 접근을 허용하거나 차단한다.</p>\n<p>CORS 에러는 출처를 구성하는 세 요소 프로토콜, 도메인(호스트 이름), 포트로 이 중 하나라도 다르면 발생하며 CORS를 설정한다는 건 ‘출처가 다른 서버 간의 리소스 공유’를 허용하는 것이다.</p>\n<h3>CORS 대응</h3>\n<p>CORS에 대응하는 방법으로는 크게 두 가지가 있다.</p>\n<ol>\n<li>서버에서 Access-Control-Allow-Origin 응답을 설정한다.</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token string-property property\">'Access-Control-Allow-Origin'</span><span class=\"token operator\">:</span> <span class=\"token constant\">URL</span></code></pre></div>\n<ol start=\"2\">\n<li>프록시 서버 사용</li>\n</ol>\n<p>Next.js 에서 제공하는 <code class=\"language-text\">rewrites</code> 를 사용하면  요청 경로를 다른 대상 경로에 매핑할 수 있다.\n<code class=\"language-text\">rewrites</code>는 URL 프록시 역할을 하며 대상 경로를 마스킹하여 사용자가 사이트에서 자신의 위치를 변경하지 않은 것처럼 보이게 한다.</p>\n<p>먼저 기존의 CORS에러가 발생했던 코드는 이렇다.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// api 함수</span>\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">getData</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> url <span class=\"token operator\">=</span> <span class=\"token string\">'https://api.data.org/data'</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">const</span> res <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">method</span><span class=\"token operator\">:</span> <span class=\"token string\">\"GET\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">headers</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token string-property property\">\"Content-Type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"application/json\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>위의 함수의 url을 변경하고 next.config 에서 rewrites()를 사용하여 설정해 주었다.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// api 함수</span>\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">getData</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> url <span class=\"token operator\">=</span> <span class=\"token string\">'api/data'</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">const</span> res <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">method</span><span class=\"token operator\">:</span> <span class=\"token string\">\"GET\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">headers</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token string-property property\">\"Content-Type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"application/json\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// next.config.js</span>\n<span class=\"token keyword\">const</span> nextConfig <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">async</span> <span class=\"token function\">rewrites</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">[</span>\n      <span class=\"token punctuation\">{</span>\n        <span class=\"token literal-property property\">source</span><span class=\"token operator\">:</span> <span class=\"token string\">'/api/:path*'</span><span class=\"token punctuation\">,</span>\n        <span class=\"token literal-property property\">destination</span><span class=\"token operator\">:</span> <span class=\"token string\">'https://api.data.org/:path*'</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">]</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span></code></pre></div>","frontmatter":{"title":"Next.js에서 CORS 대응하기","summary":"Next.js에서 CORS 대응하기","date":"2024-04-01","categories":["error","next"],"thumbnail":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","placeholder":{"fallback":"data:image/jpeg;base64,/9j/2wBDAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQH/2wBDAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQH/wgARCAAMABQDASIAAhEBAxEB/8QAGgAAAQUBAAAAAAAAAAAAAAAAAAIEBQYHCf/EABcBAAMBAAAAAAAAAAAAAAAAAAABAwX/2gAMAwEAAhADEAAAAe0tF1dniUlhAj//xAAaEAACAwEBAAAAAAAAAAAAAAADBAACBQEG/9oACAEBAAEFAtZthJbK9RzSYhBjNUaSQbz/xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAYEQACAwAAAAAAAAAAAAAAAAAQIRExUf/aAAgBAgEBPwFRT0f/xAAgEAADAAIBBQEBAAAAAAAAAAABAgMEEQUAEhMUITEQ/9oACAEBAAY/Ap3xklV/agjRrScRWTChqiXq6Rx6dqdy2sTNQrdynY642DHAx7XFp5WLHlOJ5Ohr6csrGtjNgZ9X9SpGWBTw0BEdu0tgt147TnVDolKzWiEj6CVcMuwfo+fD+dLSODhRogISksTHlRA2+4K6TVlDbOwCN7O/0/z/xAAZEAEBAQEBAQAAAAAAAAAAAAABESEAEEH/2gAIAQEAAT8h3RukuV5iHSIRzWHvMOay43mNU8jY1OCFa0h74QABwD2ds52vf//aAAwDAQACAAMAAAAQaM//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/ED//xAAZEQEBAQEBAQAAAAAAAAAAAAABIRFREDH/2gAIAQIBAT8QEoU1mvkwnNvZE3z/xAAaEAEAAgMBAAAAAAAAAAAAAAABABEQUaHR/9oACAEBAAE/EKONOCI6m5QZ58J8h8PKu/5Ac/E4oQgKIYBg9KSwprROkB30d9n/2Q=="},"images":{"fallback":{"src":"/static/2df6bd11efdc8de0ac54d805ca1ba1ab/97099/til.jpg","srcSet":"/static/2df6bd11efdc8de0ac54d805ca1ba1ab/d75cc/til.jpg 557w,\n/static/2df6bd11efdc8de0ac54d805ca1ba1ab/a3617/til.jpg 1113w,\n/static/2df6bd11efdc8de0ac54d805ca1ba1ab/97099/til.jpg 2226w","sizes":"(min-width: 2226px) 2226px, 100vw"},"sources":[{"srcSet":"/static/2df6bd11efdc8de0ac54d805ca1ba1ab/9e13a/til.webp 557w,\n/static/2df6bd11efdc8de0ac54d805ca1ba1ab/f9e0a/til.webp 1113w,\n/static/2df6bd11efdc8de0ac54d805ca1ba1ab/b09bd/til.webp 2226w","type":"image/webp","sizes":"(min-width: 2226px) 2226px, 100vw"}]},"width":2226,"height":1322}},"publicURL":"/static/2df6bd11efdc8de0ac54d805ca1ba1ab/til.jpg"}}}}]}},"pageContext":{"slug":"/CORS/"}},"staticQueryHashes":[]}